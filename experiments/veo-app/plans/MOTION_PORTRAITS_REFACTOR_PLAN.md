# Motion Portraits Page Refactor and Enhancement Plan

## Overview

This document outlines a phased approach to refactor the Motion Portraits page. The primary goals are to make the style modifier system more robust and extensible, add dynamic Veo model selection, and prepare the architecture for a more advanced, grid-based UI with video previews, as inspired by a more modern layout.

---

## Phase 1: Refactor and Externalize Style Modifiers

**Status: COMPLETE**

**Goal:** Decouple the style definitions from the UI logic and create a more descriptive prompt generation system.

**Technical Steps:**

1.  **Create `config/portrait_styles.py`:**
    *   Created a new file: `config/portrait_styles.py`.
    *   Defined a Pydantic model or dataclass named `PortraitStyle` at the top of the file.
    *   Created a list named `PORTRAIT_STYLES` of `PortraitStyle` instances.

2.  **Update `pages/portraits.py` - Data Source:**
    *   In `pages/portraits.py`, removed the hardcoded `modifier_options` list.
    *   Added the import: `from config.portrait_styles import PORTRAIT_STYLES`.
    *   The UI rendering section now iterates over `PORTRAIT_STYLES`.
    *   The button's `key` is set to `f"mod_btn_{style.id}"` and the displayed text is `style.label`.

3.  **Update `pages/portraits.py` - Prompt Logic:**
    *   In the `on_click_motion_portraits` function, the prompt construction logic was updated.
    *   The new logic creates a list of the full `PortraitStyle` objects that correspond to the selected IDs and appends each style's `description` to the `final_prompt_for_llm` string.

---

## Phase 2: Veo Model Selection and Dynamic Options

**Status: COMPLETE**

**Goal:** Empower users to select different Veo models and have the UI dynamically adapt to each model's specific capabilities.

**Technical Steps:**

1.  **Enhance `config/veo_models.py`:**
    *   The existing `config/veo_models.py` was already using a `VeoModelConfig` dataclass which was suitable for the task.

2.  **Update `pages/portraits.py` - Add Model Selector UI:**
    *   In the "Video options" section of the UI, a `me.select` component for Veo model selection was added.
    *   The `options` for this select are generated by iterating through the `VEO_MODELS` config.
    *   The selected value is stored in `state.veo_model`.

3.  **Update `pages/portraits.py` - Implement Dynamic UI:**
    *   Created a new event handler function, `on_model_selection_change(e: me.SelectSelectionChangeEvent)`.
    *   This handler is wired to the `on_selection_change` event of the new model selector.
    *   Inside this handler, the UI is dynamically updated based on the selected model's capabilities.

4.  **Update `pages/portraits.py` - Video Generation Request:**
    *   In `on_click_motion_portraits`, the `VideoGenerationRequest` is now created with the correct model version id.
    *   A bug was fixed where the full model name was being passed instead of the version id.

5.  **Implement Selection Limit in `pages/portraits.py`:**
    *   This was already implemented. The `on_modifier_click` event handler prevents selecting more than 2 modifiers.
---


## Phase 3: Grid-Based UI with Video Previews

**Status: Partially Complete**

**Goal:** Evolve the UI to match a more immersive and visual layout.

**Technical Vision:**

*   **COMPLETE** - The linear row of style modifier buttons has been replaced with a responsive grid using `flex-wrap`.
*   **PENDING** - Each item in the grid will be a `me.box` styled to be a clickable card.
*   **PENDING** - Inside each card, a `me.video` component will display the `representative_video_gcs_uri` for that style, set to loop and be muted.
*   **PENDING** - A text label (`style.label`) will be overlaid on top of the video. This will likely require careful styling with `position="absolute"` and z-indexing.
*   **PENDING** - The `on_click` handler for the card will manage the selection state, and a visual indicator (like a colored border or checkmark) will show the selected styles.