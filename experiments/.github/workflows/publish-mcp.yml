name: Publish MCP Servers

on:
  push:
    tags:
      - 'v*'

jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    strategy:
      matrix:
        server: [mcp-chirp3-go, mcp-gemini-go, mcp-imagen-go, mcp-lyria-go, mcp-veo-go]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Go
        uses: actions/setup-go@v6
        with:
          go-version: '1.22'

      - name: Install mcp-publisher
        run: go install github.com/modelcontextprotocol/registry/cmd/mcp-publisher@latest

      - name: Login to MCP Registry
        run: mcp-publisher login github-oidc

      - name: Publish MCP Server
        run: mcp-publisher publish
        working-directory: mcp-genmedia/mcp-genmedia-go/${{ matrix.server }}
