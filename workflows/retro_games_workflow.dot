digraph RetroGamesWorkflow {
    rankdir=LR;
    node [shape=box, style="rounded,filled", fontname="Arial", color=black, fillcolor=white];
    edge [fontname="Arial"];

    Start [shape=circle, label="Start", fillcolor=lightgreen];
    InputImage [label="Input Image\n(User Upload/Library/Selfie)", shape=note, fillcolor=lightyellow];
    ThemeSelection [label="Theme Selection\n(Dish/Sling/Boost)", shape=parallelogram, fillcolor=lightcyan];
    
    Generate8Bit [label="Step 1: Generate 8-bit Image\n(Gemini 2.5 Flash Image)", fillcolor=lightblue];
    GenerateCharSheet [label="Step 2: Generate Character Sheet\n(Gemini 2.5 Flash Image)", fillcolor=lightblue];
    GenerateSceneDirection [label="Step 3a: Generate Scene Direction\n(Gemini 2.5 Flash)", fillcolor=lightyellow];
    GenerateVideo [label="Step 3b: Generate Video\n(Veo 3.1 R2V)", fillcolor=lightpink];
    AppendBumper [label="Step 4: Append Bumper\n(FFmpeg/MoviePy)", fillcolor=lightgrey];
    
    FinalVideo [label="Final Retro Game Video", shape=component, fillcolor=gold];
    End [shape=doublecircle, label="End", fillcolor=lightgreen];

    Start -> InputImage;
    Start -> ThemeSelection;
    InputImage -> Generate8Bit [label="Input"];
    ThemeSelection -> Generate8Bit [label="Theme Prompt"];
    ThemeSelection -> GenerateVideo [label="Theme Logo (8-bit)"];
    
    Generate8Bit -> GenerateCharSheet [label="8-bit Image"];
    Generate8Bit -> GenerateSceneDirection [label="8-bit Image"];
    Generate8Bit -> GenerateVideo [label="R2V Ref 1 (8-bit Image)"];
    
    GenerateCharSheet -> GenerateVideo [label="R2V Ref 2 (Char Sheet)"];
    
    GenerateSceneDirection -> GenerateVideo [label="Prompt"];
    
    GenerateVideo -> AppendBumper [label="Raw Video"];
    AppendBumper -> FinalVideo;
    FinalVideo -> End;

    subgraph cluster_gemini {
        label = "Gemini Models";
        style = dashed;
        color = blue;
        Generate8Bit;
        GenerateCharSheet;
        GenerateSceneDirection;
    }

    subgraph cluster_veo {
        label = "Veo Models";
        style = dashed;
        color = red;
        GenerateVideo;
    }
}
